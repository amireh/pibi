<h1>Recurring Transies</h1>
<% content_for :layout_classes do %>bills<% end %>

<h2 class="timeframe">Yearly <span data-amount><%= current_account.yearly_expenses.to_f.round(2) %> <%= current_account.currency %></span></h2>
<% unless @yearly_transies.empty? %>
  <table data-confirmable="bills">
    <thead>
      <th>Name</th>
      <th>Amount</th>
      <th>Billing date</th>
      <th>Next bill in</th>
      <th>Active?</th>
      <th>Actions</th>
    </thead>
    <tbody>
      <% @yearly_transies.each do |t| %>
        <tr>
          <td><%= t.note %></td>
          <td class="<%= t.flow_type %>"><%= t.amount.to_f %></td>
          <td><%= natural_recurrence_date(t) %></td>
          <td>
            <% time_left = Timetastic.days_and_months_between(Time.now, t.next_billing_date) %>
            <%= "#{time_left[1]} months and #{time_left[0]} days" %>
          </td>
          <td class="<%= t.active? ? 'positive' : 'negative' %>"><%= t.active ? 'Yes' : 'No' %></td>
          <td>
            <%= actions_for(t) %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>You have not registered any yearly bills yet.</p>
<% end %>
<h2 class="timeframe">Monthly <span data-amount><%= current_account.monthly_expenses.to_f.round(2) %> <%= current_account.currency %></span></h2>
<% unless @monthly_transies.empty? %>
  <table data-confirmable="bills">
    <thead>
      <th>Name</th>
      <th>Amount</th>
      <!-- <th>Flow type</th> -->
      <th>Billing day</th>
      <th>Active?</th>
      <th>Next bill in</th>
      <th>Actions</th>
    </thead>
    <tbody>
      <% @monthly_transies.each do |t| %>
        <tr>
          <td><%= t.note %></td>
          <td class="<%= t.flow_type %>"><%= t.amount.to_f %></td>
          <!-- <td><% t.flow_type.capitalize %></td> -->
          <td><%= natural_recurrence_date(t) %></td>
          <td class="<%= t.active? ? 'positive' : 'negative' %>"><%= t.active ? 'Yes' : 'No' %></td>
          <td>
            <% if t.active %>
              <%= Timetastic.days_between(Time.now, t.next_billing_date) %> days
            <% else %>
              --
            <% end %>
          </td>
          <td>
            <%= actions_for(t) %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <p>Annual monthly change: <span data-amount><%= (current_account.monthly_expenses.to_f * 12).round(2) %> <%= current_account.currency %></span> </p>
<% else %>
  <p>You have not registered any monthly bills yet.</p>
<% end %>
<h2 class="timeframe">Daily <span data-amount><%= current_account.daily_expenses.to_f %> <%= current_account.currency %></span></h2>
<% unless @daily_transies.empty? %>
  <table data-confirmable="bills">
    <thead>
      <th>Name</th>
      <th>Amount</th>
      <th>Flow type</th>
      <th>Active?</th>
      <th>Actions</th>
    </thead>
    <tbody>
      <% @daily_transies.each do |t| %>
        <tr class="<%= t.flow_type %>">
          <td><%= t.note %></td>
          <td><%= t.amount.to_f %></td>
          <td><%= t.flow_type.capitalize %></td>
          <td><%= t.active ? 'Yes' : 'No' %></td>
          <td>
            <%= actions_for(t) %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>You have not registered any daily bills yet.</p>
<% end %>

<div class="hidden" id="bills_delete_confirmation">
  <h1>Removing bill</h1>
  <p class="warning">Are you sure you want to remove this bill?
    Note that you can simply de-activate the bill instead, and
    re-activate it later when needed.
    <br /><br />
    <em class="bad">Deleting the bill is irreversible.</em>
  </p>
</div>